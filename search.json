[{"title":"Vue","url":"/2021/08/06/Vue/","content":"\n### Vue 单页面应用模块化项目\n\n- #### 项目目录结构\n\n  ```\n  ├── public                     # 直接复制静态资源\n  │   │── favicon.ico            # favicon 图标\n  │   └── index.html             # html 模板\n  ├── src                        # 源代码\n  │   │── api                      # 全局公共请求\n  │   │── assets                   # 全局公共静态资源\n  │   │── components               # 全局公共组件\n  │   │── directive                # 全局公共指令\n  │   │── filters                  # 全局公共过滤器\n  │   │── icons                    # 全局公共图标\n  │   │── layout                   # 项目布局\n  │   │── mixins                   # 全局公共混入\n  │   │── modules                  # 模块\n  │       └── modules name\n  │           │── 与 src 下文件名相同,部分配置不相同\n  │           └── ...\n  │   │── router                   # 路由\n  │   │── store                    # 全局公共状态\n  │   │── styles                   # 样式\n  │   │── utils                    # 全局公共工具类\n  │   │── vendor                   # 公共代码块\n  │   │── views                    # 全局公共页面\n  │   │── App.vue                  # 项目入口页面\n  │   │── main.js                  # 项目入口 js\n  │   │── permission.js            # 权限控制\n  │   └── settings.js              # 项目基础设置\n  ├── .browserslistrc            # 兼容浏览器配置\n  ├── .editorconfig              # 跨编辑器代码风格\n  ├── .env.x                     # 项目环境配置\n  ├── .eslintignore              # eslint 忽略项\n  ├── .eslintrc.js               # eslint 配置\n  ├── .gitignore                 # git 忽略项\n  ├── .prettierrc                # 代码风格配置\n  ├── babel.config.js            # babel-loader 配置\n  ├── jsconfig.json              # vuter 配置\n  ├── package-lock.json          # 软件包版本\n  ├── package.json               # 项目配置清单\n  ├── postcss.config.js          # postcss 配置\n  └── vue.config.js              # vue-cli 配置\n  ```\n\n- #### 项目配置\n\n  > 因为项目是以模块化划分，所以需要将子模块的 icons,store 加载并处理。\n\n  - #### icon 相关\n\n    因为项目使用 svg-sprite-loader 实现雪碧图以方便使用 svg，所以需要加载包括子模块的 svg，在 vue.config.js 的 [chainWebpack](https://github.com/neutrinojs/webpack-chain) 配置相关。\n\n    ```javascript\n    config.module.rule(\"svg\").exclude.add(resolve(\"src\")).end();\n    config.module\n      .rule(\"icons\")\n      .test(/\\.svg$/)\n      .include.add(resolve(\"src\"))\n      .end()\n      .use(\"svg-sprite-loader\")\n      .loader(\"svg-sprite-loader\")\n      .options({\n        symbolId: \"icon-[name]\",\n      })\n      .end();\n    ```\n\n    且在 main.js 引入全局公共 icons `import '@/icons'` 后全局和子模块 icons 下的 index.js 执行。\n\n    ```javascript 全局公共\n    import Vue from \"vue\";\n    import SvgIcon from \"@/components/SvgIcon\"; // svg component\n\n    // register globally\n    Vue.component(\"svg-icon\", SvgIcon);\n\n    const reqModules = require.context(\"../modules\", true, /[\\\\/]*[\\\\/]icons$/);\n    const req = require.context(\"./svg\", false, /\\.svg$/);\n    const requireAll = (requireContext) =>\n      requireContext.keys().forEach(requireContext);\n    requireAll(req);\n    requireAll(reqModules);\n    ```\n\n    ```javascript 子模块\n    const req = require.context(\"./svg\", false, /\\.svg$/);\n    const requireAll = (requireContext) =>\n      requireContext.keys().forEach(requireContext);\n    requireAll(req);\n    ```\n\n  - #### store 相关\n\n    在 main.js 引入全局公共 store `import store from './store';` 后全局和子模块 store 下的 index.js 执行，导出写法相同。\n\n    ```javascript 全局公共\n    import Vue from \"vue\";\n    import Vuex from \"vuex\";\n    import getters from \"./getters\";\n\n    Vue.use(Vuex);\n\n    // https://webpack.js.org/guides/dependency-management/#requirecontext\n    const modulesFiles = require.context(\"./modules\", true, /\\.js$/);\n    const subModulesFiles = require.context(\n      \"../modules\",\n      true,\n      /[\\\\/]*[\\\\/]store$/\n    );\n\n    // you do not need `import app from './modules/app'`\n    // it will auto require all vuex module from modules file\n    const modules = modulesFiles.keys().reduce((modules, modulePath) => {\n      // set './app.js' => 'app'\n      const moduleName = modulePath.replace(/^\\.\\/(.\\*)\\.\\w+$/, \"$1\");\n      const value = modulesFiles(modulePath);\n      modules[moduleName] = value.default;\n      return modules;\n    }, {});\n\n    subModulesFiles.keys().forEach((path) => {\n      let value = subModulesFiles(path).default;\n      Object.assign(getters, value.getters);\n      Object.assign(modules, value.modules);\n    });\n\n    const store = new Vuex.Store({\n      modules,\n      getters,\n    });\n\n    export default store;\n    ```\n\n    ```javascript 子模块\n    const modulesFiles = require.context(\"./modules\", true, /\\.js$/);\n\n    const modules = modulesFiles.keys().reduce((modules, modulePath) => {\n      // set './app.js' => 'app'\n      const moduleName = modulePath.replace(/^\\.\\/(.*)\\.\\w+$/, \"$1\");\n      const value = modulesFiles(modulePath);\n      modules[moduleName] = value.default;\n      return modules;\n    }, {});\n\n    export default {\n      modules,\n    };\n    ```\n\n- #### 用户登录状态控制及存储\n\n  - #### 操作过程\n\n    用户通过 `login` 进行登录操作获取到 **token** 后调用 `getInfo,getModules...` 获取用户信息以及模块后跳转到门户页面进行模块选择。\n    选择模块后，调用 `getMenus` 获取所属菜单进行动态路由添加。\n\n  - #### 问题描述\n    用户登陆后，需将返回的 token,用户信息,模块保存已方便后续使用，但保存在 vuex 中的数据会在刷新或其他原因导致实例重载后初始化。所以需要将 token 存储到本地空间中，其余信息存储在 vuex 中，存储到本地后就会存在意外情况导致 token 清除。所以项目中常规会做路由跳转时的用户状态处理。\n  - #### 处理过程\n    在用户进行路由跳转时，首先进行 token 的判断，不存在的情况下判断属于白名单即直接进入，否则回退登录页，存在的情况下查看 modules 是否存在，不存在即调用 `getModules` 成功获取模块后跳转门户页。modules 存在的情况下就需要查看当前 menus 是否存在也就是是否进入了某个模块下，如果存在即跳转到菜单,如果不存在需要判断参数 `to` 是否有值以确认当前处于模块内，有值的情况下重新获取菜单并跳转否则回退门户页。\n  - #### 注意项\n\n    将数据存储在本地空间需要选择合适的存储方式\n\n    - localStorage:是永久存储在本地，除非主动删除。\n    - sessionStorage:存储到当前标签页关闭为止。\n    - cookie:如果设置有效时间则根据有效时间存储，否则为浏览器关闭时，缺点是不存存储大数据。\n\n    本项目 token 采用 cookie 的方式存储以保证各标签页无需重复登录。\n","categories":["Front end"]},{"title":"VPN","url":"/2021/04/02/SS-SSR-Trojan-V2Ray copy 3/","content":"\n## <span id=\"link\">aaa</span>\n\n> 声明:本文内容以方便正常使用为主,请遵守中华人民共和国法律法规\n\n- [心阶云](https://www.xinjiecloud.life) SSR 性价比高，超多线路，稳定老站\n- [CMYNetwork 红莓网络](https://cmy.network/index) SSR (专线)/Trojan 稳定平价\n- [MEET](https://www.ftest.cc/login) SSR 专注按量付费，高速稳定\n- [BoomCloud](https://www.boomssl.com/) V2ray/SSR/SS 多年老站，附赠丰\n- [DuangCloud](http://www.dcrelay.me/#/login) SS (全专线) 平价灵活\n- [ByWave](https://bywave.io/) V2Ray 高质高端，服务稳定\n- [Blinkload](https://dashboard.blinkload.zone/auth/login?jump_to=/user) SS (全专线) 稳定全能\n- [Electry](https://my.electry.io/#/login) V2Ray (专线、中继) 线路大佬，高速稳定\n- [V2Club](https://my.v2fly.club/#/login) SS/V2ray (全专线) 稳定坚挺，多年老站\n- [皇朝网络](https://dinastio.cc/#/login) SS 隧道 性价比新站\n","tags":["callect"]},{"title":"Promise","url":"/2021/04/01/Promise/","tags":["JavaScript"],"categories":["Front end"]}]